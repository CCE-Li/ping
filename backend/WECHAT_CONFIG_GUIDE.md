# 微信公众平台智能客服配置指南

## 1. 准备工作

### 1.1 必要信息
- 微信公众号 AppID 和 AppSecret
- 服务器外网可访问的 URL
- 自定义的 Token（用于验证）
- 消息加解密密钥（可选）

### 1.2 服务器要求
- 服务器需支持 HTTPS
- 端口需使用 80 或 443
- 确保 Flask 应用正常运行

## 2. 微信公众平台配置步骤

### 2.1 登录微信公众平台
1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 使用管理员账号登录

### 2.2 进入基本配置
1. 点击左侧菜单「设置与开发」→「基本配置」
2. 记录页面中的「AppID」和「AppSecret」

### 2.3 服务器配置
1. 点击「修改配置」按钮
2. 填写以下信息：
   - **服务器地址(URL)**: `https://your-domain.com/api/wechat`
   - **Token**: 自定义字符串，需与后端配置一致
   - **EncodingAESKey**: 随机生成或自定义
   - **消息加密方式**: 选择「安全模式」或「兼容模式」

### 2.4 启用服务器配置
1. 点击「提交」按钮
2. 微信会发送验证请求到你的服务器
3. 验证通过后，点击「启用」按钮

## 3. 后端配置

### 3.1 更新配置参数
在 `app.py` 文件中修改以下参数：

```python
# 微信公众号配置
WECHAT_APPID = 'your_appid_here'
WECHAT_APPSECRET = 'your_appsecret_here'
WECHAT_TOKEN = 'your_token_here'  # 需与微信公众平台配置一致
WECHAT_ENCODINGAESKEY = 'your_encodingaeskey_here'  # 可选
```

### 3.2 重启 Flask 应用
```bash
# 停止当前应用（如果运行中）
# Ctrl + C

# 重新启动应用
python app.py
```

## 4. 前端配置

### 4.1 更新组件参数
在使用 `WeChatSupport` 组件的地方，确保传入正确的 `wechatAppId`：

```vue
<WeChatSupport 
  wechatAppId="your_appid_here"
  wechatCorpId=""
  wechatAgentId=""
  :showNonWeChatHint="true"
/>
```

## 5. 测试验证

### 5.1 服务器配置验证
- 微信公众平台配置成功后，会显示「已启用」状态
- 后端日志会记录验证成功信息

### 5.2 智能客服功能测试
1. 在微信中关注公众号
2. 发送消息，测试自动回复
3. 点击「联系客服」按钮，测试人工客服功能
4. 测试快捷回复和自定义问答

## 6. 常见问题

### 6.1 服务器验证失败
- 检查 URL 是否正确，确保是 HTTPS
- 检查 Token 是否与微信公众平台一致
- 检查服务器是否可以外网访问

### 6.2 消息无法接收
- 检查微信 JS-SDK 初始化是否成功
- 检查前后端跨域设置
- 查看浏览器控制台和后端日志

### 6.3 自动回复异常
- 检查青云客 API 配置
- 查看后端错误日志
- 检查微信消息格式是否正确

## 7. 高级配置

### 7.1 开启消息记录
- 在 `app.py` 中启用消息记录功能
- 配置数据库连接
- 设置消息保存时长

### 7.2 自定义回复规则
在 `shopping_qa` 字典中添加更多问答规则：

```python
shopping_qa = {
    '如何购买': '点击商品详情页的「立即购买」按钮，按照提示完成支付即可',
    '配送时间': '我们的配送时间为工作日9:00-18:00，通常下单后24小时内发货',
    # 添加更多自定义问答
}
```

### 7.3 添加人工客服
在微信公众平台中设置人工客服账号，用户可以直接与客服人员对话。